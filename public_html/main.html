<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chattivo - Chat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><text x="10" y="20" font-size="20" fill="%23ddd">üéÆ</text><text x="40" y="50" font-size="15" fill="%23ddd">üëæ</text><text x="70" y="80" font-size="18" fill="%23ddd">üé®</text><text x="20" y="70" font-size="16" fill="%23ddd">üéµ</text></svg>') #e8e8e8;
            background-blend-mode: overlay;
        }

        header {
            background: rgba(180, 180, 180, 0.95);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        .bubble-small { width: 35px; height: 35px; background: #5a5a5a; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        h1 { color: #fff; font-size: 32px; font-weight: 300; letter-spacing: 2px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .welcome-text { color: #fff; font-size: 16px; }
        .logout-btn { padding: 10px 20px; border: none; border-radius: 8px; background: #4a4a4a; color: #fff; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: #3a3a3a; transform: translateY(-2px); }

        .welcome-screen { flex: 1; display: flex; justify-content: center; align-items: center; }
        .welcome-card { background: rgba(180,180,180,0.95); padding: 60px 80px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center; backdrop-filter: blur(10px); animation: fadeIn 0.5s; }
        .welcome-card h2 { color: #fff; font-size: 48px; margin-bottom: 20px; font-weight: bold; }
        .welcome-card p { color: #fff; font-size: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .main-container { flex: 1; display: none; overflow: hidden; }
        .main-container.active { display: flex; }

        .sidebar { width: 280px; background: rgba(180,180,180,0.95); backdrop-filter: blur(10px); display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        .sidebar-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .sidebar-title { color: #fff; font-size: 24px; font-weight: bold; margin-bottom: 15px; }
        .search-box { width: 100%; padding: 10px 15px; border: none; border-radius: 8px; background: rgba(255,255,255,0.2); color: #fff; font-size: 14px; outline: none; }
        .search-box::placeholder { color: rgba(255,255,255,0.7); }
        .groups-list { flex: 1; overflow-y: auto; padding: 10px; }
        .group-item { padding: 15px; margin-bottom: 5px; background: rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px; }
        .group-item:hover { background: rgba(255,255,255,0.2); transform: translateX(5px); }
        .group-item.active { background: #4a4a4a; }
        .group-avatar { width: 45px; height: 45px; border-radius: 50%; background: #5a5a5a; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .group-info { flex: 1; overflow: hidden; }
        .group-name { color: #fff; font-weight: bold; font-size: 15px; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .group-preview { color: rgba(255,255,255,0.7); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sidebar-footer { padding: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; gap: 10px; }
        .sidebar-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; background: #4a4a4a; color: #fff; cursor: pointer; transition: 0.3s; font-size: 14px; font-weight: 500; }
        .sidebar-btn:hover { background: #3a3a3a; transform: translateY(-2px); }

        .chat-container { flex: 1; display: flex; flex-direction: column; }
        .chat-header { background: rgba(180,180,180,0.95); padding: 20px 30px; backdrop-filter: blur(10px); box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: none; justify-content: space-between; align-items: center; }
        .chat-header.active { display: flex; }
        .chat-title { color: #fff; font-size: 24px; font-weight: bold; }
        .chat-actions { display: flex; gap: 10px; }
        .action-btn { padding: 8px 16px; border: none; border-radius: 6px; background: #4a4a4a; color: #fff; cursor: pointer; transition: 0.3s; font-size: 13px; }
        .action-btn:hover { background: #3a3a3a; }

        .messages-container { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 60%; padding: 12px 18px; border-radius: 15px; word-wrap: break-word; animation: slideIn 0.3s; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message-sent { background: #4a4a4a; color: #fff; align-self: flex-end; border-bottom-right-radius: 5px; }
        .message-received { background: rgba(180,180,180,0.95); color: #fff; align-self: flex-start; border-bottom-left-radius: 5px; }
        .message-info { font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 5px; display: flex; justify-content: space-between; }
        .message-sender { font-weight: bold; }

        .input-container { background: rgba(180,180,180,0.95); padding: 20px 30px; backdrop-filter: blur(10px); box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: none; gap: 15px; align-items: center; }
        .input-container.active { display: flex; }
        .message-input { flex: 1; padding: 15px 20px; border: none; border-radius: 25px; background: rgba(255,255,255,0.2); color: #fff; font-size: 15px; outline: none; }
        .message-input::placeholder { color: rgba(255,255,255,0.6); }
        .send-btn { padding: 15px 30px; border: none; border-radius: 25px; background: #4a4a4a; color: #fff; cursor: pointer; transition: 0.3s; font-size: 15px; font-weight: bold; }
        .send-btn:hover { background: #3a3a3a; transform: scale(1.05); }

        .empty-chat { text-align: center; color: rgba(255,255,255,0.8); font-size: 18px; margin-top: 100px; }
        .empty-chat h3 { color: #fff; font-size: 32px; margin-bottom: 15px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: rgba(180,180,180,0.98); padding: 35px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); backdrop-filter: blur(10px); width: 90%; max-width: 450px; }
        .modal-header { color: #fff; font-size: 28px; font-weight: bold; margin-bottom: 25px; text-align: center; }
        .modal-input { width: 100%; padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.2); color: #fff; font-size: 15px; margin-bottom: 20px; outline: none; }
        .modal-input::placeholder { color: rgba(255,255,255,0.6); }
        .modal-buttons { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: bold; transition: 0.3s; }
        .modal-btn.primary { background: #4a4a4a; color: #fff; }
        .modal-btn.primary:hover { background: #3a3a3a; }
        .modal-btn.secondary { background: rgba(255,255,255,0.2); color: #fff; }
        .modal-btn.secondary:hover { background: rgba(255,255,255,0.3); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(90,90,90,0.5); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(90,90,90,0.7); }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <div class="bubble-small">üí¨</div>
            <h1>Chattivo</h1>
        </div>
        <div class="user-info">
            <span class="welcome-text">Bienvenido, <strong id="username"></strong></span>
            <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-card">
            <h2>¬°Bienvenido a Chattivo!</h2>
            <p>Tu plataforma de chat favorita</p>
        </div>
    </div>

    <div class="main-container" id="mainContainer">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Chattivo</div>
                <input type="text" class="search-box" id="searchBox" placeholder="üîç search" oninput="filterGroups()">
            </div>
            <div class="groups-list" id="groupsList"></div>
            <div class="sidebar-footer">
                <button class="sidebar-btn" onclick="openModal('create')">‚ûï Crear</button>
                <button class="sidebar-btn" onclick="openModal('join')">üîó Unirse</button>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-header" id="chatHeader">
                <div class="chat-title" id="chatTitle">Selecciona un grupo</div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="showGroupInfo()">‚¨ÜÔ∏è</button>
                    <button class="action-btn" onclick="leaveGroup()">‚ãÆ</button>
                </div>
            </div>
            <div class="messages-container" id="messagesContainer">
                <div class="empty-chat"><h3>Selecciona un grupo</h3><p>Elige un grupo de la lista o crea uno nuevo</p></div>
            </div>
            <div class="input-container" id="inputContainer">
                <input type="text" class="message-input" id="messageInput" placeholder="Escribe un mensaje..." onkeypress="if(event.key==='Enter')sendMessage()">
                <button class="send-btn" onclick="sendMessage()">‚ûï</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modal" onclick="if(event.target===this)closeModal()">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle"></div>
            <input type="text" class="modal-input" id="modalInput" placeholder="Nombre del grupo" maxlength="30">
            <div class="modal-buttons">
                <button class="modal-btn primary" id="modalConfirm"></button>
                <button class="modal-btn secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = '', currentGroup = null, groups = {}, messages = {};

        window.onload = function() {
            const username = localStorage.getItem('username');
            if (!username) return window.location.href = 'login.html';
            
            currentUser = username;
            document.getElementById('username').textContent = username;
            
            const savedGroups = localStorage.getItem('chattivo_groups');
            const savedMessages = localStorage.getItem('chattivo_messages');
            if (savedGroups) groups = JSON.parse(savedGroups);
            if (savedMessages) messages = JSON.parse(savedMessages);
            
            setTimeout(() => {
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('mainContainer').classList.add('active');
                renderGroups();
            }, 3000);
        };

        function saveData() {
            localStorage.setItem('chattivo_groups', JSON.stringify(groups));
            localStorage.setItem('chattivo_messages', JSON.stringify(messages));
        }

        function renderGroups() {
            const list = document.getElementById('groupsList');
            const userGroups = Object.keys(groups).filter(id => groups[id].members.includes(currentUser));
            
            if (!userGroups.length) {
                list.innerHTML = '<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.6)">No tienes grupos a√∫n</div>';
                return;
            }
            
            list.innerHTML = userGroups.map(id => {
                const group = groups[id];
                const lastMsg = (messages[id] || []).slice(-1)[0];
                return `<div class="group-item ${currentGroup === id ? 'active' : ''}" onclick="selectGroup('${id}')">
                    <div class="group-avatar">üë•</div>
                    <div class="group-info">
                        <div class="group-name">${group.name}</div>
                        <div class="group-preview">${lastMsg ? lastMsg.sender + ': ' + lastMsg.text : ''}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function selectGroup(id) {
            currentGroup = id;
            renderGroups();
            renderMessages();
            document.getElementById('chatHeader').classList.add('active');
            document.getElementById('inputContainer').classList.add('active');
            document.getElementById('chatTitle').textContent = groups[id].name;
        }

        function renderMessages() {
            const container = document.getElementById('messagesContainer');
            const msgs = messages[currentGroup] || [];
            
            if (!currentGroup || !msgs.length) {
                container.innerHTML = '<div class="empty-chat"><h3>Sin mensajes a√∫n</h3><p>S√© el primero en enviar un mensaje</p></div>';
                return;
            }
            
            container.innerHTML = msgs.map(m => `
                <div class="message ${m.sender === currentUser ? 'message-sent' : 'message-received'}">
                    <div>${m.text}</div>
                    <div class="message-info"><span class="message-sender">${m.sender}</span><span>${m.time}</span></div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text || !currentGroup) return;
            
            if (!messages[currentGroup]) messages[currentGroup] = [];
            const now = new Date();
            messages[currentGroup].push({
                sender: currentUser,
                text: text,
                time: now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0')
            });
            
            input.value = '';
            saveData();
            renderMessages();
            renderGroups();
        }

        function openModal(type) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const input = document.getElementById('modalInput');
            const btn = document.getElementById('modalConfirm');
            
            if (type === 'create') {
                title.textContent = 'Crear Nuevo Grupo';
                btn.textContent = 'Crear';
                btn.onclick = createGroup;
            } else {
                title.textContent = 'Unirse a Grupo';
                btn.textContent = 'Unirse';
                btn.onclick = joinGroup;
            }
            
            input.value = '';
            modal.classList.add('active');
            input.focus();
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function createGroup() {
            const name = document.getElementById('modalInput').value.trim();
            if (!name) return alert('Ingresa un nombre para el grupo');
            
            const id = 'group_' + Date.now();
            groups[id] = { name, creator: currentUser, members: [currentUser], createdAt: new Date().toISOString() };
            saveData();
            renderGroups();
            closeModal();
            selectGroup(id);
        }

        function joinGroup() {
            const name = document.getElementById('modalInput').value.trim();
            if (!name) return alert('Ingresa el nombre del grupo');
            
            const id = Object.keys(groups).find(i => groups[i].name.toLowerCase() === name.toLowerCase());
            if (!id) return alert('No se encontr√≥ un grupo con ese nombre');
            if (groups[id].members.includes(currentUser)) {
                alert('Ya eres miembro de este grupo');
                closeModal();
                return selectGroup(id);
            }
            
            groups[id].members.push(currentUser);
            saveData();
            renderGroups();
            closeModal();
            selectGroup(id);
        }

        function showGroupInfo() {
            if (!currentGroup) return;
            const g = groups[currentGroup];
            alert(`Grupo: ${g.name}\nCreador: ${g.creator}\nMiembros: ${g.members.join(', ')}`);
        }

        function leaveGroup() {
            if (!currentGroup || !confirm('¬øSalir de este grupo?')) return;
            
            groups[currentGroup].members = groups[currentGroup].members.filter(m => m !== currentUser);
            if (!groups[currentGroup].members.length) {
                delete groups[currentGroup];
                delete messages[currentGroup];
            }
            
            currentGroup = null;
            saveData();
            renderGroups();
            document.getElementById('chatHeader').classList.remove('active');
            document.getElementById('inputContainer').classList.remove('active');
            document.getElementById('messagesContainer').innerHTML = '<div class="empty-chat"><h3>Selecciona un grupo</h3><p>Elige un grupo de la lista o crea uno nuevo</p></div>';
        }

        function filterGroups() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            document.querySelectorAll('.group-item').forEach(item => {
                const name = item.querySelector('.group-name').textContent.toLowerCase();
                item.style.display = name.includes(search) ? 'flex' : 'none';
            });
        }

        function logout() {
            localStorage.removeItem('username');
            localStorage.removeItem('loginMethod');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>